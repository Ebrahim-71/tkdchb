cat > /home/fltqlsof/api.chbtkd.ir/templates/azbankgateways/redirect_to_bank.html <<'EOF'
<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>انتقال به درگاه</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; padding:16px; line-height:1.7;}
    pre{direction:ltr; white-space:pre-wrap; background:#f5f5f5; padding:12px; border:1px solid #ddd; border-radius:8px;}
    .warn{background:#fff3cd; border:1px solid #ffecb5; padding:10px; border-radius:8px; margin:12px 0;}
    .ok{background:#e7f7ee; border:1px solid #c7eed8; padding:10px; border-radius:8px; margin:12px 0;}
    button{padding:10px 14px; border-radius:10px; border:1px solid #111; background:#111; color:#fff; cursor:pointer;}
    button[disabled]{opacity:.5; cursor:not-allowed;}
    .small{font-size:13px; color:#555;}
  </style>
</head>
<body>

<h3>در حال انتقال به درگاه…</h3>
<p class="small">اگر انتقال انجام نشد، یعنی view هنوز پارامترهای لازم را تولید نکرده است.</p>

<pre>
url={{ url|default_if_none:"" }}
method={{ method|default_if_none:"post" }}
params={{ params }}
</pre>

{% if url %}
  <div class="ok">آدرس درگاه آماده است؛ در حال ارسال…</div>

  <form id="id_form" action="{{ url }}" method="{{ method|default:'post' }}">
    {% for k,v in params.items %}
      <input type="hidden" name="{{ k }}" value="{{ v }}">
    {% endfor %}
    <button type="submit">ارسال به درگاه</button>
  </form>

  <script>
    // ارسال خودکار (اگر دوست نداری، این 2 خط را کامنت کن)
    document.getElementById('id_form').submit();
  </script>
{% else %}
  <div class="warn">
    url خالی است؛ یعنی هنوز redirect_gateway ساخته نشده.
    باید override در اولین درخواست (فقط tc) redirect بدهد و سپس با url برگردد.
  </div>

  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="tc" value="{{ params.tc|default_if_none:'' }}">
    <button type="submit">تلاش مجدد</button>
  </form>
{% endif %}

</body>
</html>
EOF
